<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário com Assinatura</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input, textarea, canvas, button {
            width: 100%;
            margin-bottom: 20px;
        }
        canvas {
            border: 1px solid #ccc;
            height: 150px;
        }
    </style>
</head>
<body>
    <form id="form">
        <h1>Formulário com Assinatura</h1>
        <label for="name">Nome:</label>
        <input type="text" id="name" name="name" required>

        <label for="email">E-mail:</label>
        <input type="email" id="email" name="email" required>

        <label for="message">Mensagem:</label>
        <textarea id="message" name="message" required></textarea>

        <label>Assinatura:</label>
        <canvas id="signature"></canvas>
        <button type="button" id="clear-signature">Limpar Assinatura</button>

        <button type="submit">Enviar</button>
    </form>

    <script>
        const form = document.getElementById('form');
        const signatureCanvas = document.getElementById('signature');
        const clearButton = document.getElementById('clear-signature');
        const ctx = signatureCanvas.getContext('2d');

        let isDrawing = false;

        // Configurações iniciais do canvas
        function resizeCanvas() {
            signatureCanvas.width = signatureCanvas.offsetWidth;
            signatureCanvas.height = signatureCanvas.offsetHeight;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Funções para desenhar
        signatureCanvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            ctx.beginPath();
            ctx.moveTo(e.offsetX, e.offsetY);
        });

        signatureCanvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
        });

        signatureCanvas.addEventListener('mouseup', () => isDrawing = false);
        signatureCanvas.addEventListener('mouseout', () => isDrawing = false);

        // Limpar assinatura
        clearButton.addEventListener('click', () => {
            ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
        });

        // Enviar o formulário
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Captura a assinatura como base64
            const signatureData = signatureCanvas.toDataURL('image/png');

            // Monta o corpo do e-mail
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const message = document.getElementById('message').value;

            const emailBody = `
                Nome: ${name}\n
                E-mail: ${email}\n
                Mensagem: ${message}\n
                Assinatura em anexo.
            `;

            // Converter base64 para Blob
            const signatureBlob = await fetch(signatureData).then(res => res.blob());

            // Criar o FormData
            const formData = new FormData();
            formData.append('_replyto', email);
            formData.append('message', emailBody);
            formData.append('attachment', signatureBlob, 'signature.png');

            // Enviar via Formspree
            const response = await fetch('https://formspree.io/f/xvgoakqv', {
                method: 'POST',
                body: formData,
            });

            if (response.ok) {
                alert('Formulário enviado com sucesso!');
                form.reset();
                ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
            } else {
                alert('Ocorreu um erro ao enviar o formulário.');
            }
        });
    </script>
</body>
</html>
